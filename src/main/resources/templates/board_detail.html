<!-- board_detail.html -->
<html layout:decorate="~{layout}" xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title>board 생성</title>
</head>
<body>
<div layout:fragment="content">
    <div class="flex flex-col p-5 gap-6">
        <!-- 제목 -->
        <div>
            <div class="text-xl font-bold" th:text="${board.subject}"></div>
        </div>
        <!-- 내용 -->
        <div>
            <div class="min-h-28 text-sm text-[#616161] bg-[#F6F6F6] p-3 rounded-lg" th:text="${board.content}"></div>
        </div>

        <!-- 모집 인원 -->
        <div class="flex flex-col gap-1">
            <div class="text-sm font-bold">현재 모집중인 인원수</div>
            <div class="flex gap-1 text-sm">
                <div>모집 현황: </div>
                <div th:text="${board.currentNumber}"></div>
                <div>/</div>
                <div th:text="${board.recruitNumber}"></div>
            </div>
        </div>

        <!-- 진행 기간 -->
        <div class="flex flex-col gap-1">
            <div class="text-sm font-bold">소모임 진행기간</div>
            <div class="flex gap-1 text-sm">
                <div th:text="${board.getFormattedStartDay}"></div>
                <div>~</div>
                <div th:text="${board.getFormattedEndDay}"></div>
            </div>
        </div>

        <!-- 소모임 진행 지역 -->
        <div class="flex flex-col gap-1">
            <div class="text-sm font-bold">소모임 진행 지역</div>
            <div class="text-sm" th:text="${board.region}"></div>
        </div>

        <!-- recommend to -->
        <div class="flex flex-col gap-1">
            <div class="text-sm font-bold">이런 사람들에게 추천해요!</div>
            <div class="text-sm" th:text="${board.recommendedTo}"></div>
        </div>

    <div sec:authorize="isAuthenticated()"  th:if="${ #authentication.principal.username == board.user.username}">
        <form th:action="@{|/board/edit/${board.id}|}" method="get">
            <button type="submit" class="btn btn-secondary w-full text-sm">글 수정하기</button>
        </form>
        <form th:action="@{|/board/delete/${board.id}|}" method="get">
            <button type="submit" class="delete btn btn-primary w-full text-sm" >글 삭제하기</button>
        </form>
    </div>
    <div sec:authorize="isAuthenticated()" th:if="${#authentication.principal == null or #authentication.principal.username != board.user.username}">
        <form th:action="@{|/participations/create/${board.id}|}" method="post">
            <button type="submit" class="btn btn-primary w-full text-sm">참여하기</button>
        </form>
    </div>

    <div >
        <div>참여신청 인원(<span th:text="${board.participations.size()}"/>명)</div>
        <ul>
            <li th:each="participation : ${board.participations}">
                <div>
                    <span th:text="${participation.participant.username}"></span>
                    <span th:text="${participation.participant.contactNumber}"></span>
                    <span th:text="${participation.getStatusDisplay()}"></span>

                    <!-- 게시글 작성자일 경우 수락/거절 버튼 -->
                    <div sec:authorize="isAuthenticated()" th:if="${#authentication.principal.username == board.user.username}">
                        <form th:action="@{|/participations/accept/${participation.id}|}" method="post">
                            <input type="submit" value="수락하기">
                        </form>
                        <form th:action="@{|/participations/reject/${participation.id}|}" method="post">
                            <input type="submit" value="거절하기">
                        </form>
                    </div>

                    <!-- 참여자 본인일 경우 신청 취소 버튼 -->
                    <div sec:authorize="isAuthenticated()" th:if="${#authentication.principal != null and #authentication.principal.username == participation.participant.username}">
                        <form th:action="@{|/participations/cancel/${participation.id}|}" method="post">
                            <input type="submit" value="신청취소">
                        </form>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</div>
<script layout:fragment="script" type='text/javascript'>
    const delete_elements = document.getElementsByClassName("delete");
    Array.from(delete_elements).forEach(function(element) {
        element.addEventListener('click', function() {
            if(confirm("정말로 삭제하시겠습니까?")) {
                location.href = this.dataset.uri;
            };
        });
    });
</script>
</body>
</html>
